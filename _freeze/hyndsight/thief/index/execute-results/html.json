{
  "hash": "b7ac14244cde00e2604cedc11187a48e",
  "result": {
    "markdown": "---\ndate: 2016-08-22 07:58:42+00:00\nlink: https://robjhyndman.com/hyndsight/thief/\nslug: thief\ntitle: 'The thief package for R: Temporal HIErarchical Forecasting'\ncategories:\n- forecasting\n- R\n- seasonality\n- time series\n---\n\n\nI have a new R package available to do temporal hierarchical forecasting, based on [my paper with George Athanasopoulos, Nikolaos Kourentzes and Fotios Petropoulos](/publications/temporal-hierarchies/). (Guess the odd guy out there!)\n\nIt is called [\"thief\"](http://github.com/robjhyndman/thief) - an acronym for Temporal HIErarchical Forecasting. The idea is to take a seasonal time series, and compute all possible temporal aggregations that result in an integer number of observations per year. For example, a quarterly time series is aggregated to biannual and annual; while a monthly time series is aggregated to 2-monthly, quarterly, 4-monthly, biannual and annual. Each of the resulting time series are forecast, and then the forecasts are reconciled using the hierarchical reconciliation algorithm described in our paper.\n\nIt turns out that this tends to give better forecasts, even though no new information has been added, especially for time series with long seasonal periods. It also allows different types of forecasts for different forecast horizons to be combined in a consistent manner.\n\n<!-- more -->\n\nThe main function is `thief` which can be used like any of the forecast functions from the `forecast` package. For example:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-1_6ca3a37692c60965554a82f83feb5c46'}\n\n:::\n\n::: {.cell hash='index_cache/html/thief_2402281da7b19a14b7d1607e89163a04'}\n\n```{.r .cell-code}\nlibrary(thief)\nlibrary(ggplot2)\nfc <- thief(USAccDeaths)\nautoplot(fc)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/thief-1.png){width=672}\n:::\n:::\n\n\nUnder the hood, the `thief` function computes the temporal aggregates, then calculates all forecasts (using `ets` by default), and finally reconciles the forecasts using the approach described in our paper. The reconciled forecasts corresponding to the original series are returned.\n\nThere are options for computing forecasts using other methods such as `auto.arima`, the Theta method, or a user-defined forecast function.\n\nThere are also functions for doing each part separately: `tsaggregates` will compute all aggregated time series, `reconcilethief` will reconcile a list of time series (or a list of forecast objects) of different levels of temporal aggregation.\n\nHere is an example using these lower-level functions. This example is in the paper, and uses weekly data (which we treat as having seasonal period of 52).\n\n\n::: {.cell hash='index_cache/html/thief2_5d55c313b252515ae820cd51e6f979f2'}\n\n```{.r .cell-code}\n# Original series: Total Weekly Emergency Admissions in the UK\ntotal <- AEdemand[,12]\n\n# Construct all temporal aggregates\ntotalagg <- tsaggregates(total)\nautoplot(totalagg, main=\"Total Emergency Admissions\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/thief2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Compute base forecasts\nbase <- list()\nfor(i in seq_along(totalagg))\n  base[[i]] <- forecast(auto.arima(totalagg[[i]]),\n                 h=2*frequency(totalagg[[i]]), level=80)\n\n# Reconcile forecasts\nreconciled <- reconcilethief(base)\n\n#Plot original and reconciled forecasts\npar(mfrow=c(2,3), mar=c(3,3,1,0))\nfor(i in 6:1)\n{\n  plot(reconciled[[i]], main=names(totalagg)[i],\n       xlim=c(2010.5,2017.5), flwd=1)\n  lines(base[[i]]$mean, col=\"red\")\n}\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/thief2-2.png){width=672}\n:::\n:::\n\n\nThe red line represents the original base forecasts and the blue line the reconciled forecasts. Observe how different the base forecasts are across the aggregation levels. At the annual level there is no trend captured in the forecast due to the limited fitting sample, and there is a weak trend captured in the weekly forecasts due to the noisy data. But the trend is quite strong at the intermediate temporal aggregation levels.  Similarly seasonality is captured relatively accurately in the quarterly, monthly and bi-weekly levels, but not at the weekly level. Once these are reconciled, the trend at the annual and weekly levels are stronger, and the weekly seasonality looks more reasonable.\n\nFor now, the package is [available on github](http://github.com/robjhyndman/thief) only. It will probably migrate to CRAN soon.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}