{
  "hash": "f54d8fa3db6696316ad30274dcde62f6",
  "result": {
    "markdown": "---\ndate: 2018-07-14\nslug: tslm-decomposition\ntitle: \"Seasonal decomposition of short time series\"\ncategories:\n  - seasonality\n  - time series\n  - R\n---\n\n\n\n\nMany users have tried to do a seasonal decomposition with a short time series, and hit the error \"Series has less than two periods\".\n\nThe problem is that the usual methods of decomposition (e.g., `decompose` and `stl`) estimate seasonality using at least as many degrees of freedom as there are seasonal periods. So you need at least two observations per seasonal period to be able to distinguish seasonality from noise.\n\nHowever, it is possible to use a linear regression model to decompose a time series into trend and seasonal components, and then some smoothness assumptions on the seasonal component allow a decomposition with fewer than two full years of data.\n\nThis problem [came up on crossvalidated.com](https://stackoverflow.com/q/51329598/144157) recently, with the following data set.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-1_72b7f8e660378ca74500db07854f6bf7'}\n\n```{.r .cell-code}\ndf <- ts(c(2735.869,2857.105,2725.971,2734.809,2761.314,2828.224,2830.284,\n  2758.149,2774.943,2782.801,2861.970,2878.688,3049.229,3029.340,3099.041,\n  3071.151,3075.576,3146.372,3005.671,3149.381), start=c(2016,8), frequency=12)\n```\n:::\n\n\nWe can approximate the seasonal pattern using [Fourier terms](https://otexts.org/fpp2/useful-predictors.html#fourier-series) with a few parameters.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-2_7a1c196831d04caa8c660d45a6809ac9'}\n\n```{.r .cell-code}\nlibrary(forecast)\nlibrary(ggplot2)\ndecompose_df <- tslm(df ~ trend + fourier(df, 2))\n```\n:::\n\n\nThen the usual decomposition plot can be constructed.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-3_cda2fb57665f23dbf38590243fd7478a'}\n\n```{.r .cell-code}\ntrend <- coef(decompose_df)[1] + coef(decompose_df)['trend']*seq_along(df)\ncomponents <- cbind(\n  data = df,\n  trend = trend,\n  season = df - trend - residuals(decompose_df),\n  remainder = residuals(decompose_df)\n)\nautoplot(components, facet=TRUE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nHere the model is\n$$\n  y_t = \\alpha + \\beta t + \\sum_{k=1}^K \\left[\n    \\gamma_k \\sin\\left(\\textstyle\\frac{2\\pi t k}{m}\\right) +\n    \\psi_k \\cos\\left(\\textstyle\\frac{2\\pi t k}{m}\\right)\n    \\right] + \\varepsilon_t,\n$$\nwhere $1 \\le K \\le m/2$. The larger the value of $K$, the more complicated the seasonal pattern that can be estimated. If $K=m/2$, then we are using $m-1$ degrees of freedom for the seasonal component. (The last sin term will be dropped as $\\sin(\\pi t)=0$ for all $t$.) For a short time series, we can use a small value for $K$, which can be selected by minimizing the AICc or leave-one-out CV statistic (both computed using `CV()`). In the above example, the AICc is minimized with $K=1$ and CV is minimized with $K=2$.\n\nThe trend could also be made nonlinear, by replacing `trend` with a polynomial or spline (although both will use up more degrees of freedom, and may not be justified with short time series).\n\nAs with other methods of decomposition, it is easy enough to remove the seasonal component to get the seasonally adjusted data.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-4_ebb21726be6a489096f9dc4efd00258a'}\n\n```{.r .cell-code}\nadjust_df <- df - components[,'season']\nautoplot(df, series=\"Data\") +\n  autolayer(adjust_df, series=\"Seasonally adjusted\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}