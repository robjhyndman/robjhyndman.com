{
  "hash": "457bae2c2eb1e31c460b2bdc9cee3e5a",
  "result": {
    "markdown": "---\ndate: 2020-05-24\ntitle: \"Seasonal mortality rates\"\nslug: seasonal-mortality-rates\naliases:\n  - /hyndsight/2020-05-seasonal-deaths\ncategories:\n  - time series\n  - statistics\n  - demography\nimage: index_files/figure-html/england2-1.png\n---\n\n\n\n\nThe weekly mortality data recently published by the [Human Mortality Database](https://www.mortality.org) can be used to explore seasonality in mortality rates. Mortality rates are known to be seasonal due to temperatures and other weather-related effects [(Healy 2003)](http://dx.doi.org/10.1136/jech.57.10.784).\n\n<!--more-->\n\nThe weekly mortality data recently published by the [Human Mortality Database](https://www.mortality.org) can be used to explore seasonality in mortality rates. Mortality rates are known to be seasonal due to temperatures and other weather-related effects [(Healy 2003)](http://dx.doi.org/10.1136/jech.57.10.784).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(tsibble)\nlibrary(feasts)\n```\n:::\n\n\n## Download the data\n\nWe will first grab the latest data, using similar code to what I used in my recent post on [\"excess deaths\"](https://robjhyndman.com/hyndsight/excess-deaths/). However, this time we will keep the mortality rates rather than the numbers of deaths.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstmf <- readr::read_csv(\"https://www.mortality.org/Public/STMF/Outputs/stmf.csv\", skip=1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmrates <- stmf %>%\n  janitor::clean_names() %>%\n  select(country_code:sex, r0_14:r_total) %>%\n  pivot_longer(5:10,\n    names_to = \"age\", values_to = \"mxt\",\n    names_pattern = \"[r_]*([a-z0-9_p]*)\"\n  ) %>%\n  filter(age == \"total\", sex == \"b\") %>%\n  mutate(\n    country = recode(country_code,\n      AUT = \"Austria\",\n      BEL = \"Belgium\",\n      DEUTNP = \"Germany\",\n      DNK = \"Denmark\",\n      ESP = \"Spain\",\n      FIN = \"Finland\",\n      GBRTENW = \"England & Wales\",\n      ISL = \"Iceland\",\n      NLD = \"Netherlands\",\n      NOR = \"Norway\",\n      PRT = \"Portugal\",\n      SWE = \"Sweden\",\n      USA = \"United States\"\n    )\n  ) %>%\n  select(year, week, country, mxt)\n```\n:::\n\n\nFirst let's plot the mortality rate against the week of the year for two countries with interesting data features.\n\n## England & Wales\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmrates %>%\n  filter(country == \"England & Wales\") %>%\n  mutate(year = as.factor(year)) %>%\n  ggplot(aes(x = week, y = mxt, group = year)) +\n  geom_line(aes(col = year))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/england2-1.png){width=672}\n:::\n:::\n\n\nHere we see some annual seasonal pattern, with higher rates in winter, and also a few sudden dips in mortality rates. The latter are almost certainly due to recording discrepancies, where deaths are not recorded until the following week. Note that the dips are generally followed by a higher than usual mortality rate in the following week. Those between weeks 12 and 17 are probably due to Easter; bank holiday effects are seen in weeks 18-19, 22-23 and 35-36 (depending on which year the holiday falls; the Christmas effect is seen in week 52.\n\nThe second week of the year always has increased mortality --- this is a reporting issue: delayed deaths from the previous week(s) are included in statistics for the second week of the year.\n\nOther than the obvious pandemic effect in 2020, this graph also shows increased mortality rates at the start of 2015 and 2018, and in the first half of March 2018.  This is probably due to the flu epidemic.\n\n## Spain\n\nA similar plot for Spain shows a jump in mortality from weeks 31--34 (August) in 2003. This was due to an extreme heat wave (see [Robine et al, 2008](https://doi.org/10.1016/j.crvi.2007.12.001)).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmrates %>%\n  filter(country == \"Spain\") %>%\n  mutate(year = as.factor(year)) %>%\n  ggplot(aes(x = week, y = mxt, group = year)) +\n  geom_line(aes(col = year))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n# Comparing seasonality across countries\n\nWe can compare the seasonal patterns from all countries by using an STL decomposition to estimate the seasonality. There will be some differences because some countries provide weekly data by date of registration (instead of the date of occurrence). This is why, for example, we see sudden dips in England & Wales but do not see similar dips in Germany. Information about the type of data available is in [the metadata](https://www.mortality.org/File/GetDocument/Public/STMF_DOC/STMFmetadata.pdf).\n\nFirst we have to convert the data to a tsibble object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmrates <- mrates %>%\n  mutate(date = yearweek(paste0(year, \"W\", week))) %>%\n  as_tsibble(index = date, key = country)\n```\n:::\n\n\nNow we estimate the seasonal components using an STL decomposition. The robust argument is used to prevent the unusual years affecting the results, and the seasonal window is set to periodic as we don't expect the seasonal pattern to change over the last decade or two. STL decompositions are additive, but it would be more interpretable to look at the percentage increase in mortality rates across the year, so I will decompose the log rates and then compute the seasonal effect as a percentage increase (relative to the mean death rate) for each week of the year. There are a couple of missing values, so I will replace them with something small and the robust estimation should ignore them.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstl_season <- mrates %>%\n  fill_gaps(mxt = 0.0001) %>%\n  model(STL(log(mxt) ~ season(window = \"periodic\"), robust = TRUE)) %>%\n  components() %>%\n  mutate(\n    pc_increase = 100*(exp(season_year)-1),\n    week = lubridate::week(date),\n    year = lubridate::year(date)\n  ) %>%\n  filter(year == 2019) %>%\n  as_tibble() %>%\n  select(country, week, pc_increase)\n```\n:::\n\n\nThe smoothed components can now be plotted.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstl_season %>%\n  ggplot(aes(x = week, y = pc_increase, group = country)) +\n  geom_smooth(aes(col = country), span = 0.4, se = FALSE, size = .5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nMost countries are very similar, probably due to them all being in the northern hemisphere and all having well-developed health services. The two that stand out as different from the rest are Portugal (in purple) and Iceland (in green). Let's just plot these two with confidence intervals, along with Spain for comparison.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstl_season %>%\n  filter(country %in% c(\"Iceland\", \"Portugal\", \"Spain\")) %>%\n  ggplot(aes(x = week, y = pc_increase, group = country)) +\n  geom_smooth(aes(col = country), span = 0.4, size = .5) +\n  ggthemes::scale_color_colorblind()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nThe Icelandic rates show less seasonality than other countries, but contain a dip in weeks 25--35 (mid-June to end of August). The Iceland mortality pattern is possibly due to the weather, with a very short summer and cold conditions for the rest of the year.\n\nThe Portuguese mortality rates are much higher in winter than other countries, and much lower in summer. This is strange as it has very similar weather to Spain, but very different mortality rates. Some [twitter discussion](https://twitter.com/Thoughtfulnz/status/1264426705046786050) suggested some of the increase in January could be delayed reporting, as few deaths are reported in the last week of the year. [Healy (2003)](http://dx.doi.org/10.1136/jech.57.10.784) suggested it was due to poor insulation in Portuguese houses, along with relatively high income poverty and inequality and relatively low public health expenditure compared to other European countries. However, it is not clear that this is still true 17 years after he wrote that article.\n\n<details><summary>Reproducibility details</summary>\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(width = 100)\nsessioninfo::session_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.1 (2022-06-23)\n os       KDE neon User - 5.25\n system   x86_64, linux-gnu\n ui       X11\n language\n collate  en_AU.UTF-8\n ctype    en_AU.UTF-8\n tz       Europe/Rome\n date     2022-09-10\n pandoc   2.19.2 @ /usr/bin/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────────────────────────\n package        * version    date (UTC) lib source\n anytime          0.3.9      2020-08-27 [3] RSPM (R 4.2.0)\n assertthat       0.2.1      2019-03-21 [3] RSPM (R 4.2.0)\n bspm             0.3.9      2022-01-04 [2] CRAN (R 4.2.1)\n cli              3.3.0      2022-04-25 [3] RSPM (R 4.2.0)\n colorspace       2.0-3      2022-02-21 [3] RSPM (R 4.2.0)\n DBI              1.1.3      2022-06-18 [3] RSPM (R 4.2.0)\n digest           0.6.29     2021-12-01 [3] RSPM (R 4.2.0)\n distributional   0.3.1.9000 2022-09-04 [1] Github (mitchelloharawild/distributional@a2ffbe7)\n dplyr          * 1.0.10     2022-09-01 [3] RSPM (R 4.2.0)\n ellipsis         0.3.2      2021-04-29 [3] RSPM (R 4.2.0)\n evaluate         0.16       2022-08-09 [3] RSPM (R 4.2.0)\n fabletools     * 0.3.2      2021-11-29 [3] RSPM (R 4.2.0)\n fansi            1.0.3      2022-03-24 [3] RSPM (R 4.2.0)\n farver           2.1.1      2022-07-06 [3] RSPM (R 4.2.0)\n fastmap          1.1.0      2021-01-25 [3] RSPM (R 4.2.0)\n feasts         * 0.3.0.9000 2022-09-02 [1] Github (tidyverts/feasts@1bac96c)\n generics         0.1.3      2022-07-05 [3] RSPM (R 4.2.0)\n ggplot2        * 3.3.6      2022-05-03 [3] RSPM (R 4.2.0)\n ggthemes         4.2.4      2021-01-20 [3] RSPM (R 4.2.0)\n glue             1.6.2      2022-02-24 [3] RSPM (R 4.2.0)\n gtable           0.3.1      2022-09-01 [3] RSPM (R 4.2.0)\n here             1.0.1      2020-12-13 [1] RSPM (R 4.2.0)\n htmltools        0.5.3      2022-07-18 [3] RSPM (R 4.2.0)\n htmlwidgets      1.5.4      2021-09-08 [3] RSPM (R 4.2.0)\n janitor          2.1.0      2021-01-05 [3] RSPM (R 4.2.0)\n jsonlite         1.8.0      2022-02-22 [3] RSPM (R 4.2.0)\n knitr            1.40       2022-08-24 [3] RSPM (R 4.2.0)\n labeling         0.4.2      2020-10-20 [3] RSPM (R 4.2.0)\n lattice          0.20-45    2021-09-22 [4] CRAN (R 4.2.0)\n lifecycle        1.0.1      2021-09-24 [3] RSPM (R 4.2.0)\n lubridate        1.8.0      2021-10-07 [3] RSPM (R 4.2.0)\n magrittr         2.0.3      2022-03-30 [3] RSPM (R 4.2.0)\n Matrix           1.4-1      2022-03-23 [3] RSPM (R 4.2.0)\n mgcv             1.8-40     2022-03-29 [3] RSPM (R 4.2.0)\n munsell          0.5.0      2018-06-12 [3] RSPM (R 4.2.0)\n nlme             3.1-159    2022-08-09 [3] RSPM (R 4.2.0)\n pillar           1.8.1      2022-08-19 [3] RSPM (R 4.2.0)\n pkgconfig        2.0.3      2019-09-22 [3] RSPM (R 4.2.0)\n progressr        0.11.0     2022-09-02 [3] RSPM (R 4.2.0)\n purrr            0.3.4      2020-04-17 [3] RSPM (R 4.2.0)\n R6               2.5.1      2021-08-19 [3] RSPM (R 4.2.0)\n Rcpp             1.0.9      2022-07-08 [3] RSPM (R 4.2.0)\n rlang            1.0.5      2022-08-31 [3] RSPM (R 4.2.0)\n rmarkdown        2.16       2022-08-24 [3] RSPM (R 4.2.0)\n rprojroot        2.0.3      2022-04-02 [3] RSPM (R 4.2.0)\n scales           1.2.1      2022-08-20 [3] RSPM (R 4.2.0)\n sessioninfo      1.2.2      2021-12-06 [3] RSPM (R 4.2.0)\n snakecase        0.11.0     2019-05-25 [3] RSPM (R 4.2.0)\n stringi          1.7.8      2022-07-11 [3] RSPM (R 4.2.0)\n stringr          1.4.1      2022-08-20 [3] RSPM (R 4.2.0)\n tibble           3.1.8      2022-07-22 [3] RSPM (R 4.2.0)\n tidyr          * 1.2.0      2022-02-01 [3] RSPM (R 4.2.0)\n tidyselect       1.1.2      2022-02-21 [3] RSPM (R 4.2.0)\n tsibble        * 1.1.2      2022-08-22 [1] Github (tidyverts/tsibble@f422d9d)\n utf8             1.2.2      2021-07-24 [3] RSPM (R 4.2.0)\n vctrs            0.4.1      2022-04-13 [3] RSPM (R 4.2.0)\n withr            2.5.0      2022-03-03 [3] RSPM (R 4.2.0)\n xfun             0.32.3     2022-09-07 [1] Github (yihui/xfun@38670ad)\n yaml             2.3.5      2022-02-21 [3] RSPM (R 4.2.0)\n\n [1] /home/robjhyndman/R/x86_64-pc-linux-gnu-library/4.2\n [2] /usr/local/lib/R/site-library\n [3] /usr/lib/R/site-library\n [4] /usr/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n\n\n</details>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}