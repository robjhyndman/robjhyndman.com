{
  "hash": "72a96c8edcefc69e2342db2669b18064",
  "result": {
    "markdown": "---\ndate: 2019-08-30\nslug: feasts\ntitle: Time series graphics using feasts\ncategories:\n- time series\n- graphics\n- statistics\n- R\n- tidyverts\nimage: index_files/figure-html/autoplot-1.png\n---\n\n\n\n\nThis is the second post on the new [tidyverts](https://tidyverts.org) packages for tidy time series analysis. The previous post is [here](https://robjhyndman.com/hyndsight/tsibbles).\n\nFor users migrating from the `forecast` package, it might be useful to see how to get similar graphics to those they are used to. The `forecast` package is built for `ts` objects, while the `feasts` package provides features, statistics and graphics for `tsibbles`. (See my [first post](https://robjhyndman.com/hyndsight/tsibbles) for a description of tsibbles.)\n\n## Exploratory graphics\n\nThe `forecast` package provided facilities for plotting time series in various ways. All of these have a counterpart in the `feasts` package.\n\n\n::: {.cell hash='index_cache/html/translation_199dd7dc111434653f5351f5078b1bea'}\n::: {.cell-output-display}\n|forecast            |feasts                  |\n|:-------------------|:-----------------------|\n|`autoplot()`        |`autoplot()`            |\n|`ggseasonplot()`    |`gg_season()`           |\n|`ggsubseriesplot()` |`gg_subseries()`        |\n|`gglagplot()`       |`gg_lag()`              |\n|`ggAcf()`           |`ACF() %>% autoplot()`  |\n|`ggPacf()`          |`PACF() %>% autoplot()` |\n|`ggtsdisplay()`     |`gg_tsdisplay()`        |\n:::\n:::\n\n\n\nThe big difference is that tsibbles can contain multiple time series, while `ts` objects can only contain one (possibly multivariate) time series. Note also that the `feasts` functions will only do one thing --- either compute some statistics or produce a plot --- unlike the `ggAcf()` function which does both.\n\nWe will illustrate the above functions use the Australian quarterly holiday data by State, created in the last post.\n\n\n::: {.cell hash='index_cache/html/holidays_681ca0b8e714775a31f090749b2f4ebe'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tsibble)\nholidays <- tourism %>%\n  filter(Purpose == \"Holiday\") %>%\n  group_by(State) %>%\n  summarise(Trips = sum(Trips))\n```\n:::\n\n\nFirst, a time plot is generated using `autoplot()`.\n\n\n::: {.cell hash='index_cache/html/autoplot_06233df50bc4402eb4cc2d261acbabc2'}\n\n```{.r .cell-code}\nlibrary(feasts)\nholidays %>% autoplot(Trips)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/autoplot-1.png){width=960}\n:::\n:::\n\n\nWhen the plotting variable (here `Trips`) is omitted, the first available measurement variable is used by default. When there are no keys, only one time series is shown with no legend.\n\nA season plot is shown below. Here it is clear that the southern states of Australia (Tasmania, Victoria and South Australia) have strongest tourism in Q1 (their summer), while the northern states (Queensland and the Northern Territory) have the strongest tourism in Q3 (their dry season).\n\n\n::: {.cell hash='index_cache/html/gg_season_825e036a8bcb98b8c698ad2b7f73a5ab'}\n\n```{.r .cell-code}\nholidays %>% gg_season(Trips)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/gg_season-1.png){width=480}\n:::\n:::\n\n\nA subseries plot allows changes in seasonality over time to be easily visualized. The blue lines shows the mean across the years in each panel. Here it is clear that Western Australian tourism has jumped markedly in recent years, while Victorian tourism has increased in Q1 and Q4 but not in the middle of the year.\n\n\n::: {.cell hash='index_cache/html/gg_subseries_624904ff7c2a2ff245c99099ae4d4aff'}\n\n```{.r .cell-code}\nholidays %>% gg_subseries(Trips)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/gg_subseries-1.png){width=672}\n:::\n:::\n\n\nThe ACF is commonly used to assess the dynamic information in a time series. This is computed using the `ACF()` function for all series. This also produces a tsibble, but with the index being the lag.\n\n\n::: {.cell hash='index_cache/html/ACF_7701c71954664f36d858d231688ee2f4'}\n\n```{.r .cell-code}\nholidays %>% ACF(Trips)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tsibble: 152 x 3 [1Q]\n# Key:       State [8]\n   State   lag      acf\n   <chr> <lag>    <dbl>\n 1 ACT      1Q  0.0877 \n 2 ACT      2Q  0.252  \n 3 ACT      3Q -0.0496 \n 4 ACT      4Q  0.300  \n 5 ACT      5Q -0.0741 \n 6 ACT      6Q  0.269  \n 7 ACT      7Q -0.00504\n 8 ACT      8Q  0.236  \n 9 ACT      9Q -0.0953 \n10 ACT     10Q  0.0750 \n# â€¦ with 142 more rows\n```\n:::\n:::\n\n\nTo plot the ACFs for all series, we can pass the result to `autoplot()`.\n\n\n::: {.cell hash='index_cache/html/ACFplot_e66c32d57719b9f7adf097fc0ebb6bc3'}\n\n```{.r .cell-code}\nholidays %>% ACF(Trips) %>% autoplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/ACFplot-1.png){width=576}\n:::\n:::\n\n\nHere, the low seasonality in the ACT is evident compared to the other states.\n\nThe remaining two graphical methods require only one time series. So we filter out the Tasmanian holiday data to illustrate them.\n\n\n::: {.cell hash='index_cache/html/lagplot_280fcec06bf09a34d5949623ba14489b'}\n\n```{.r .cell-code}\nholidays %>% filter(State==\"Tasmania\") %>% gg_lag(Trips, geom=\"point\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/lagplot-1.png){width=576}\n:::\n:::\n\n\nThis lag plot shows a scatterplot of the lagged observation (vertical axis) against the current observation, with points coloured by the current quarter. The correlations of these lag plots are what make up the ACF. In this example, it is clear that Q1 is a strong quarter for Tasmania, and that the seasonality induces positive correlations at lags 4 and 8, but negative correlations at lags 2 and 6.\n\nFinally, we show a composite plot created using `gg_tsdisplay()`. This is a little different from the corresponding `ggtsdisplay()` function in the forecast package which showed the PACF in the bottom right panel by default. I think the season plot is a little more informative for exploratory data analysis, so that is what is shown by default in this new function. The other panels are the same.\n\n\n::: {.cell hash='index_cache/html/gg_tsdisplay_9e0092894065e560dbcd25d7e86e0837'}\n\n```{.r .cell-code}\nholidays %>% filter(State==\"Tasmania\") %>% gg_tsdisplay(Trips)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/gg_tsdisplay-1.png){width=960}\n:::\n:::\n\n\n## Decompositions\n\nThe stats package provides the `stl()` function for STL decomposition of single time series with one seasonal period. The forecast package extended this with `mstl()` to allow for multiple seasonal periods. The feasts package allows for more flexible seasonality and for multiple series to be handled simultaneously.\n\n\n::: {.cell hash='index_cache/html/stl_9d9fd73203085b582ff2aceb3b456fa6'}\n\n```{.r .cell-code}\nholidays %>% model(STL(Trips)) %>% components() %>% autoplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/stl-1.png){width=960}\n:::\n:::\n\n\nAll components from all series are shown here. Note that the annual seasonality has been estimated by default. With time series containing other seasonal periods, more than one seasonal component will be produced. These can be controlled using the `STL` arguments.\n\nTo demonstrate on a more difficult series, here is an STL decomposition for half hourly electricity data.\n\n\n::: {.cell hash='index_cache/html/stl2_b69e86e661ef91c1c9b13a56ad16ae80'}\n\n```{.r .cell-code}\nlibrary(lubridate)\ntsibbledata::vic_elec %>%\n  filter(yearmonth(Date) >= yearmonth(\"2014 Oct\")) %>%\n  model(STL(Demand ~ trend(window=77) + season(window=\"periodic\"))) %>%\n  components() %>%\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/stl2-1.png){width=960}\n:::\n:::\n\n\nThe hourly seasonality is largely meaningless -- we do not expect electricity demand to have a periodic effect within the hour -- and the daily seasonality has been largely captured in the weekly seasonality above it. The confounding of these two components makes it hard to interpret the daily seasonality. So we can drop the hourly and daily components and just model the weekly seasonality instead.\n\n\n::: {.cell hash='index_cache/html/stl3_0fc252d001f682e5a00e27e8d14bdd33'}\n\n```{.r .cell-code}\ntsibbledata::vic_elec %>%\n  filter(yearmonth(Date) >= yearmonth(\"2014 Oct\")) %>%\n  model(STL(\n    Demand ~ trend(window=77) +\n        season(\"week\", window=\"periodic\")\n  )) %>%\n  components %>%\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/stl3-1.png){width=960}\n:::\n:::\n\n\nThe remainder term captures the difference from what you would expect if the demand was simply a function of the time of week. The variations from the weekly pattern, due to holidays or unusual weather, will show up in the remainder series.\n\n## Features and statistics\n\nThe `feasts` package does much more than graphics, but that can wait until a future post.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}