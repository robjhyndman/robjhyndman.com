{
  "hash": "5440a019d21335200fc8cf795d9ebead",
  "result": {
    "markdown": "---\ndate: 2020-05-21\ntitle: \"Excess deaths for 2020\"\nslug: excess-deaths\ncategories:\n  - time series\n  - statistics\n  - epidemiology\n  - demography\nimage: index_files/figure-html/weekly-1.png\n---\n\n\n\n\nThe reported COVID19 deaths in each country are often undercounts due to different reporting practices, or people dying of COVID19 related causes without ever being tested. One way to explore the true mortality effect of the pandemic is to look at \"excess deaths\" --- the difference between death rates this year and the same time in previous years.\n\nThe [*Financial Times*](http://ft.com/coronavirus-latest) (and other media outlets) have been collecting data from many countries to try to measure this effect. Now the [Human Mortality Database](https://www.mortality.org/) has made this much easier by publishing weekly deaths data for 13 countries.\n\nUnfortunately, many countries do not have the processes in place to allow such data to be readily available. In Australia, for example, the [most recent official deaths data](https://www.abs.gov.au/AUSSTATS/abs@.nsf/mf/3302.0) is from 2018! The fact that there is no public organized national data collection for deaths during a pandemic is a sad indictment on the responsible government authorities.\n\n## Download the data\n\nHere is some code to download and organize the data from the HMD\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstmf <- readr::read_csv(\"https://www.mortality.org/Public/STMF/Outputs/stmf.csv\", skip=1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstmf\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 29,994 × 19\n   CountryCode  Year  Week Sex   D0_14 D15_64 D65_74 D75_84  D85p DTotal\n   <chr>       <dbl> <dbl> <chr> <dbl>  <dbl>  <dbl>  <dbl> <dbl>  <dbl>\n 1 AUT          2000     1 m      6.28   184.   211.   237.  176.    814\n 2 AUT          2000     1 f      5.35   101.   141.   335.  471.   1053\n 3 AUT          2000     1 b     11.5    285.   355.   573.  643.   1867\n 4 AUT          2000     2 m      6.58   192.   217.   244.  180.    840\n 5 AUT          2000     2 f      5.81   109.   141.   335.  471.   1062\n 6 AUT          2000     2 b     12.2    302.   359.   580.  650.   1902\n 7 AUT          2000     3 m      7.73   226.   220.   248.  183.    886\n 8 AUT          2000     3 f      6.11   115.   152.   361.  507.   1141\n 9 AUT          2000     3 b     13.8    341.   378.   610.  684.   2027\n10 AUT          2000     4 m      7.30   214.   217.   245.  181.    864\n# … with 29,984 more rows, and 9 more variables: R0_14 <dbl>,\n#   R15_64 <dbl>, R65_74 <dbl>, R75_84 <dbl>, R85p <dbl>, RTotal <dbl>,\n#   Split <dbl>, SplitSex <dbl>, Forecast <dbl>\n```\n:::\n:::\n\n\nThe columns beginning with `D` show deaths for different age groups, while mortality rates are in the columns starting with `R`.\n\n## Wrangle the data into long form\n\nLet's drop the rates columns and wrangle it into a form more suitable for analysis. To keep it simple, I'll only keep aggregate deaths over age and sex.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths <- stmf %>%\n  janitor::clean_names() %>%\n  select(country_code:d_total) %>%\n  pivot_longer(5:10,\n    names_to = \"age\", values_to = \"deaths\",\n    names_pattern = \"[d_]*([a-z0-9_p]*)\"\n  ) %>%\n  filter(age == \"total\", sex == \"b\") %>%\n  mutate(\n    country = recode(country_code,\n      AUT = \"Austria\",\n      BEL = \"Belgium\",\n      DEUTNP = \"Germany\",\n      DNK = \"Denmark\",\n      ESP = \"Spain\",\n      FIN = \"Finland\",\n      GBRTENW = \"England & Wales\",\n      ISL = \"Iceland\",\n      NLD = \"Netherlands\",\n      NOR = \"Norway\",\n      PRT = \"Portugal\",\n      SWE = \"Sweden\",\n      USA = \"United States\")\n  ) %>%\n  select(year, week, country, deaths)\n```\n:::\n\n\nThe only tricky part here is in converting the age groups which are part of the column names into a variable using a regex via `names_pattern`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9,998 × 4\n    year  week country deaths\n   <dbl> <dbl> <chr>    <dbl>\n 1  2000     1 Austria   1867\n 2  2000     2 Austria   1902\n 3  2000     3 Austria   2027\n 4  2000     4 Austria   1940\n 5  2000     5 Austria   1928\n 6  2000     6 Austria   1760\n 7  2000     7 Austria   1666\n 8  2000     8 Austria   1628\n 9  2000     9 Austria   1566\n10  2000    10 Austria   1524\n# … with 9,988 more rows\n```\n:::\n:::\n\n\n## Weekly deaths highlighting 2020\n\nNow we can plot the deaths from this year compared to those from all other available years (the start year ranges from 1990 for Finland to 2017 for Iceland).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths %>%\n  mutate(thisyear = (year == 2020)) %>%\n  ggplot(aes(x=week, y=deaths, group=year)) +\n    geom_line(aes(col=thisyear)) +\n    facet_wrap(~ country, scales='free_y') +\n    scale_color_manual(values=c(\"FALSE\"='gray',\"TRUE\"='red')) +\n    guides(col=FALSE) +\n    ggtitle(\"Weekly deaths\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: `guides(<scale> = FALSE)` is deprecated. Please use\n`guides(<scale> = \"none\")` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/weekly-1.png){width=672}\n:::\n:::\n\n\nClearly there are a few problems with the last week of available data from Finland, Norway and the United States. These are due to incomplete counts as noted in the [meta data provided by HMD](https://www.mortality.org/Public/STMF_DOC/STMFmetadata.pdf), and the same problem may affect other countries too. As more data are made available, earlier weeks may also be updated.\n\nNote that there is a lag before the data are made available. We can see how far each country is behind by comparing the last week of available data with the current week number.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths %>%\n  filter(year==2020) %>%\n  group_by(country) %>%\n  summarise(last_week = max(week)) %>%\n  mutate(\n    current_week = lubridate::week(Sys.Date()),\n    lag = current_week - last_week\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 13 × 4\n   country         last_week current_week   lag\n   <chr>               <dbl>        <dbl> <dbl>\n 1 Austria                14           36    22\n 2 Belgium                19           36    17\n 3 Denmark                17           36    19\n 4 England & Wales        18           36    18\n 5 Finland                18           36    18\n 6 Germany                16           36    20\n 7 Iceland                15           36    21\n 8 Netherlands            16           36    20\n 9 Norway                 17           36    19\n10 Portugal               18           36    18\n11 Spain                  19           36    17\n12 Sweden                 18           36    18\n13 United States          17           36    19\n```\n:::\n:::\n\n\nBefore continuing, I'll remove that last week of data for all countries (which will make the lag one week longer).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeaths <- deaths %>%\n  group_by(country, year) %>%\n  filter(!(year==2020 & week==max(week))) %>%\n  select(year, week, country, deaths)\n```\n:::\n\n\n## Estimate excess deaths\n\nTo estimate the total excess deaths up to the most recent data, we can first compute weekly median deaths over the last five years, then calculate the difference between the 2020 deaths numbers and these weekly medians. I'm using medians because Germany appears to have some big fluctuations at the start of the year and I'm not sure how reliable those numbers are.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrecent_deaths <- deaths %>%\n  filter(year >= 2015 & year <= 2019) %>%\n  group_by(country,week) %>%\n  summarise(median_deaths = median(deaths)) %>%\n  ungroup()\nexcess_deaths <- deaths %>%\n  filter(year >= 2015) %>%\n  left_join(recent_deaths) %>%\n  mutate(excess = deaths - median_deaths)\nexcess_deaths %>%\n  mutate(thisyear = (year == 2020)) %>%\n  ggplot(aes(x=week, y=excess, group=year)) +\n  geom_hline(yintercept=0, col='gray') +\n  geom_line(aes(col=thisyear)) +\n  facet_wrap(~ country, scales='free_y') +\n  scale_color_manual(values=c(\"FALSE\"='gray',\"TRUE\"='red')) +\n  guides(col=FALSE) +\n  ggtitle(\"Weekly excess deaths\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: `guides(<scale> = FALSE)` is deprecated. Please use\n`guides(<scale> = \"none\")` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/excess-1.png){width=672}\n:::\n:::\n\n\nThis graph shows the excess deaths of the last six years, with 2020 highlighted in red. The other years help to see the natural variability in this calculation. Interestingly, many countries have negative excess deaths for the first 10 weeks of the year, probably due to precautions being taken before the virus had spread. So there were fewer car accidents, for example.\n\nI'm fairly sure the numbers for the United States in the last week shown above are also incorrect, as the official COVID19 deaths have not stopped decreasing, but the data will presumably get corrected over time.\n\nFinally, we can summarise the total excess deaths per country for 2020.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexcess_deaths %>%\n  filter(year==2020) %>%\n  group_by(country) %>%\n  summarise(\n    excess = sum(excess),\n    last_week = max(week),\n    as_at = as.Date(\"2020-01-01\") + 7*(last_week-1)\n  ) %>%\n  select(country, excess, as_at)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 13 × 3\n   country         excess as_at     \n   <chr>            <dbl> <date>    \n 1 Austria          -204  2020-03-25\n 2 Belgium          6322  2020-04-29\n 3 Denmark          -485  2020-04-15\n 4 England & Wales 33581  2020-04-22\n 5 Finland          -260  2020-04-22\n 6 Germany          -602. 2020-04-08\n 7 Iceland             5  2020-04-01\n 8 Netherlands      4670  2020-04-08\n 9 Norway           -558  2020-04-15\n10 Portugal         -168  2020-04-22\n11 Spain           19530  2020-04-29\n12 Sweden           1227  2020-04-22\n13 United States    8457  2020-04-15\n```\n:::\n:::\n\n\n  * Some countries have negative excess deaths, due to early interventions.\n  * The numbers for England & Wales and the United States are substantially lower than what the [*Financial Times*](http://ft.com/coronavirus-latest) is estimating, probably due to the available data. I suspect the data used by the *FT* is more recent.\n  * These numbers are substantially larger than the numbers of reported COVID19 deaths at the same date.\n  * Further discussion on \"excess deaths\" is available in [this article](https://voxeu.org/article/excess-mortality-england-european-outlier-covid-19-pandemic) from VoxEU.\n\n<details><summary>Reproducibility details</summary>\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(width=100)\nsessioninfo::session_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.1 (2022-06-23)\n os       KDE neon User - 5.25\n system   x86_64, linux-gnu\n ui       X11\n language\n collate  en_AU.UTF-8\n ctype    en_AU.UTF-8\n tz       Europe/Rome\n date     2022-09-04\n pandoc   2.19.2 @ /usr/bin/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────────────────────────\n package     * version date (UTC) lib source\n assertthat    0.2.1   2019-03-21 [3] RSPM (R 4.2.0)\n bspm          0.3.9   2022-01-04 [2] CRAN (R 4.2.1)\n cli           3.3.0   2022-04-25 [3] RSPM (R 4.2.0)\n colorspace    2.0-3   2022-02-21 [3] RSPM (R 4.2.0)\n DBI           1.1.3   2022-06-18 [3] RSPM (R 4.2.0)\n digest        0.6.29  2021-12-01 [3] RSPM (R 4.2.0)\n dplyr       * 1.0.9   2022-04-28 [3] RSPM (R 4.2.0)\n ellipsis      0.3.2   2021-04-29 [3] RSPM (R 4.2.0)\n evaluate      0.16    2022-08-09 [3] RSPM (R 4.2.0)\n fansi         1.0.3   2022-03-24 [3] RSPM (R 4.2.0)\n farver        2.1.1   2022-07-06 [3] RSPM (R 4.2.0)\n fastmap       1.1.0   2021-01-25 [3] RSPM (R 4.2.0)\n generics      0.1.3   2022-07-05 [3] RSPM (R 4.2.0)\n ggplot2     * 3.3.6   2022-05-03 [3] RSPM (R 4.2.0)\n glue          1.6.2   2022-02-24 [3] RSPM (R 4.2.0)\n gtable        0.3.0   2019-03-25 [3] RSPM (R 4.2.0)\n here          1.0.1   2020-12-13 [1] RSPM (R 4.2.0)\n htmltools     0.5.3   2022-07-18 [3] RSPM (R 4.2.0)\n htmlwidgets   1.5.4   2021-09-08 [3] RSPM (R 4.2.0)\n janitor       2.1.0   2021-01-05 [3] RSPM (R 4.2.0)\n jsonlite      1.8.0   2022-02-22 [3] RSPM (R 4.2.0)\n knitr         1.40    2022-08-24 [3] RSPM (R 4.2.0)\n labeling      0.4.2   2020-10-20 [3] RSPM (R 4.2.0)\n lifecycle     1.0.1   2021-09-24 [3] RSPM (R 4.2.0)\n lubridate     1.8.0   2021-10-07 [3] RSPM (R 4.2.0)\n magrittr      2.0.3   2022-03-30 [3] RSPM (R 4.2.0)\n munsell       0.5.0   2018-06-12 [3] RSPM (R 4.2.0)\n pillar        1.8.1   2022-08-19 [3] RSPM (R 4.2.0)\n pkgconfig     2.0.3   2019-09-22 [3] RSPM (R 4.2.0)\n purrr         0.3.4   2020-04-17 [3] RSPM (R 4.2.0)\n R6            2.5.1   2021-08-19 [3] RSPM (R 4.2.0)\n rlang         1.0.5   2022-08-31 [3] RSPM (R 4.2.0)\n rmarkdown     2.16    2022-08-24 [3] RSPM (R 4.2.0)\n rprojroot     2.0.3   2022-04-02 [3] RSPM (R 4.2.0)\n scales        1.2.1   2022-08-20 [3] RSPM (R 4.2.0)\n sessioninfo   1.2.2   2021-12-06 [3] RSPM (R 4.2.0)\n snakecase     0.11.0  2019-05-25 [3] RSPM (R 4.2.0)\n stringi       1.7.8   2022-07-11 [3] RSPM (R 4.2.0)\n stringr       1.4.1   2022-08-20 [3] RSPM (R 4.2.0)\n tibble        3.1.8   2022-07-22 [3] RSPM (R 4.2.0)\n tidyr       * 1.2.0   2022-02-01 [3] RSPM (R 4.2.0)\n tidyselect    1.1.2   2022-02-21 [3] RSPM (R 4.2.0)\n utf8          1.2.2   2021-07-24 [3] RSPM (R 4.2.0)\n vctrs         0.4.1   2022-04-13 [3] RSPM (R 4.2.0)\n withr         2.5.0   2022-03-03 [3] RSPM (R 4.2.0)\n xfun          0.32    2022-08-10 [3] RSPM (R 4.2.0)\n yaml          2.3.5   2022-02-21 [3] RSPM (R 4.2.0)\n\n [1] /home/robjhyndman/R/x86_64-pc-linux-gnu-library/4.2\n [2] /usr/local/lib/R/site-library\n [3] /usr/lib/R/site-library\n [4] /usr/lib/R/library\n\n──────────────────────────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n\n\n</details>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}